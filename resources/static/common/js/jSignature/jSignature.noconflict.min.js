;(function(a){(function(){function I(e){for(var i,k=e.css("color"),l,e=e[0],p=!1;e&&!l&&!p;){try{i=a(e).css("background-color")}catch(n){i="transparent"}"transparent"!==i&&"rgba(0, 0, 0, 0)"!==i&&(l=i);p=e.body;e=e.parentNode}var e=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,p=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,h;i=void 0;(i=k.match(e))?h={r:parseInt(i[1],10),g:parseInt(i[2],10),b:parseInt(i[3],10)}:(i=k.match(p))&&(h={r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)});var m;l?(i=void 0,(i=l.match(e))?m={r:parseInt(i[1],10),g:parseInt(i[2],10),b:parseInt(i[3],10)}:(i=l.match(p))&&(m={r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)})):m=h?127<Math.max.apply(null,[h.r,h.g,h.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};i=function(c){return"rgb("+[c.r,c.g,c.b].join(", ")+")"};h&&m?(e=Math.max.apply(null,[h.r,h.g,h.b]),h=Math.max.apply(null,[m.r,m.g,m.b]),h=Math.round(h+-0.75*(h-e)),h={r:h,g:h,b:h}):h?(h=Math.max.apply(null,[h.r,h.g,h.b]),e=1,127<h&&(e=-1),h=Math.round(h+96*e),h={r:h,g:h,b:h}):h={r:191,g:191,b:191};return{color:k,"background-color":m?i(m):l,"decor-color":i(h)}}function M(c,d){this.x=c;this.y=d;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var e=function(f){return Math.round(f/Math.abs(f))};this.resizeTo=function(f){if(0===this.x&&0===this.y){this._length=0}else{if(0===this.x){this._length=f,this.y=f*e(this.y)}else{if(0===this.y){this._length=f,this.x=f*e(this.x)}else{var i=Math.abs(this.y/this.x),h=Math.sqrt(Math.pow(f,2)/(1+Math.pow(i,2))),i=i*h;this._length=f;this.x=h*e(this.x);this.y=i*e(this.y)}}}return this};this.angleTo=function(f){var h=this.getLength()*f.getLength();return 0===h?0:Math.acos(Math.min(Math.max((this.x*f.x+this.y*f.y)/h,-1),1))/Math.PI}}function O(c,d){this.x=c;this.y=d;this.getVectorToCoordinates=function(e,f){return new M(e-this.x,f-this.y)};this.getVectorFromCoordinates=function(e,f){return this.getVectorToCoordinates(e,f).reverse()};this.getVectorToPoint=function(e){return new M(e.x-this.x,e.y-this.y)};this.getVectorFromPoint=function(e){return this.getVectorToPoint(e).reverse()}}function E(u,k,v,n,t){this.data=u;this.context=k;if(u.length){for(var r=u.length,p,h,m=0;m<r;m++){p=u[m];h=p.x.length;v.call(k,p);for(var q=1;q<h;q++){n.call(k,p,q)}t.call(k,p)}}this.changed=function(){};this.startStrokeFn=v;this.addToStrokeFn=n;this.endStrokeFn=t;this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(c){if(c&&"number"==typeof c.x&&"number"==typeof c.y){this._stroke={x:[c.x],y:[c.y]};this.data.push(this._stroke);this._lastPoint=c;this.inStroke=!0;var e=this._stroke,d=this.startStrokeFn,f=this.context;setTimeout(function(){d.call(f,e)},3);return c}return null};this.addToStroke=function(c){if(this.inStroke&&"number"===typeof c.x&&"number"===typeof c.y&&4<Math.abs(c.x-this._lastPoint.x)+Math.abs(c.y-this._lastPoint.y)){var e=this._stroke.x.length;this._stroke.x.push(c.x);this._stroke.y.push(c.y);this._lastPoint=c;var d=this._stroke,i=this.addToStrokeFn,f=this.context;setTimeout(function(){i.call(f,d,e)},3);return c}return null};this.endStroke=function(){var c=this.inStroke;this.inStroke=!1;this._lastPoint=null;if(c){var e=this._stroke,d=this.endStrokeFn,i=this.context,f=this.changed;setTimeout(function(){d.call(i,e);f.call(i)},3);return !0}return null}}function G(z,q,A){var u=this.$parent=a(z),z=this.eventTokens={};this.events=new s(this);var y=a.fn[S]("globalEvents"),x={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,data:[]};a.extend(x,I(u));q&&a.extend(x,q);this.settings=x;for(var v in A){A.hasOwnProperty(v)&&A[v].call(this,v)}this.events.publish(S+".initializing");this.$controlbarUpper=a('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1em !important;margin-bottom:1em !important;"></div>').appendTo(u);this.isCanvasEmulator=!1;A=this.canvas=this.initializeCanvas(x);q=a(A);this.$controlbarLower=a('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1.5em !important;margin-bottom:1.5em !important;"></div>').appendTo(u);this.$signatureTools=a(".jSignatureToolsBar");this.canvasContext=A.getContext("2d");q.data(S+".this",this);u=(u=x.lineWidth)?u:Math.max(Math.round(A.width/400),2);x.lineWidth=u;this.lineCurveThreshold=3*x.lineWidth;x.cssclass&&""!=a.trim(x.cssclass)&&q.addClass(x.cssclass);this.fatFingerCompensation=0;var u=function(c){var h,f,i=function(d){d=d.changedTouches&&0<d.changedTouches.length?d.changedTouches[0]:d;return new O(Math.round(d.pageX+h),Math.round(d.pageY+f)+c.fatFingerCompensation)},l=new g(750,function(){c.dataEngine.endStroke()});this.drawEndHandler=function(n){try{n.preventDefault()}catch(d){}l.clear();
c.dataEngine.endStroke()};this.drawStartHandler=function(n){n.preventDefault();var d=a(c.canvas).offset();h=-1*d.left;f=-1*d.top;c.dataEngine.startStroke(i(n));l.kick()};this.drawMoveHandler=function(d){d.preventDefault();c.dataEngine.inStroke&&(c.dataEngine.addToStroke(i(d)),l.kick())};return this}.call({},this),m=u.drawEndHandler,r=u.drawStartHandler,e=u.drawMoveHandler,t=this.canvas,q=a(t);this.isCanvasEmulator?(q.bind("mousemove."+S,e),q.bind("mouseup."+S,m),q.bind("mousedown."+S,r)):(t.ontouchstart=function(c){t.onmousedown=void 0;t.onmouseup=void 0;t.onmousemove=void 0;this.fatFingerCompensation=x.minFatFingerCompensation&&-3*x.lineWidth>x.minFatFingerCompensation?-3*x.lineWidth:x.minFatFingerCompensation;r(c);t.ontouchend=m;t.ontouchstart=r;t.ontouchmove=e},t.onmousedown=function(c){t.ontouchstart=void 0;t.ontouchend=void 0;t.ontouchmove=void 0;r(c);t.onmousedown=r;t.onmouseup=m;t.onmousemove=e});z[S+".windowmouseup"]=y.subscribe(S+".windowmouseup",u.drawEndHandler);this.events.publish(S+".attachingEventHandlers");var k=this,z=x.width.toString(10),B=S;if("ratio"===z||"%"===z.split("")[z.length-1]){this.eventTokens[B+".parentresized"]=y.subscribe(B+".parentresized",function(c,f,d){return function(){var Y=f.width();if(Y!==d){for(var ab in c){c.hasOwnProperty(ab)&&(y.unsubscribe(c[ab]),delete c[ab])}var ac=k.settings;k.$parent.children().remove();for(ab in k){k.hasOwnProperty(ab)&&delete k[ab]}ab=ac.data;var Y=1*Y/d,Z=[],w,W,aa,X,C,n;W=0;for(aa=ab.length;W<aa;W++){n=ab[W];w={x:[],y:[]};X=0;for(C=n.x.length;X<C;X++){w.x.push(n.x[X]*Y),w.y.push(n.y[X]*Y)}Z.push(w)}ac.data=Z;f[B](ac)}}}(this.eventTokens,this.$parent,this.$parent.width(),1*this.canvas.width/this.canvas.height))}this.resetCanvas(x.data);this.events.publish(S+".initialized");return this}var S="jSignature",g=function(c,e){var d;this.kick=function(){clearTimeout(d);d=setTimeout(e,c)};this.clear=function(){clearTimeout(d)};return this},s=function(c){this.topics={};this.context=c?c:this;this.publish=function(x,y,r,v){if(this.topics[x]){var w=this.topics[x],t=Array.prototype.slice.call(arguments,1),m=[],n,u,q,k;u=0;for(q=w.length;u<q;u++){k=w[u],n=k[0],k[1]&&(k[0]=function(){},m.push(u)),n.apply(this.context,t)}u=0;for(q=m.length;u<q;u++){w.splice(m[u],1)}}};this.subscribe=function(d,e,f){this.topics[d]?this.topics[d].push([e,f]):this.topics[d]=[[e,f]];return{topic:d,callback:e}};this.unsubscribe=function(e){if(this.topics[e.topic]){for(var f=this.topics[e.topic],h=0,i=f.length;h<i;h++){f[h][0]===e.callback&&f.splice(h,1)}}}},b=function(e){var f=this.canvasContext,i=e.x[0],e=e.y[0],h=this.settings.lineWidth,k=f.fillStyle;f.fillStyle=f.strokeStyle;f.fillRect(i+h/-2,e+h/-2,h,h);f.fillStyle=k},D=function(C,W){var z=new O(C.x[W-1],C.y[W-1]),v=new O(C.x[W],C.y[W]),B=z.getVectorToPoint(v);if(1<W){var x=new O(C.x[W-2],C.y[W-2]),r=x.getVectorToPoint(z),t;if(r.getLength()>this.lineCurveThreshold){t=2<W?(new O(C.x[W-3],C.y[W-3])).getVectorToPoint(x):new M(0,0);var y=0.35*r.getLength(),u=r.angleTo(t.reverse()),k=B.angleTo(r.reverse());t=(new M(t.x+r.x,t.y+r.y)).resizeTo(Math.max(0.05,u)*y);var q=(new M(r.x+B.x,r.y+B.y)).reverse().resizeTo(Math.max(0.05,k)*y),r=this.canvasContext,y=x.x,k=x.y,u=z.x,X=z.y,m=x.x+t.x,x=x.y+t.y;t=z.x+q.x;q=z.y+q.y;r.beginPath();r.moveTo(y,k);r.bezierCurveTo(m,x,t,q,u,X);r.stroke()}}B.getLength()<=this.lineCurveThreshold&&(B=this.canvasContext,x=z.x,z=z.y,t=v.x,v=v.y,B.beginPath(),B.moveTo(x,z),B.lineTo(t,v),B.stroke())},j=function(t){var u=t.x.length-1;if(0<u){var q=new O(t.x[u],t.y[u]),m=new O(t.x[u-1],t.y[u-1]),r=m.getVectorToPoint(q);if(r.getLength()>this.lineCurveThreshold){if(1<u){var t=(new O(t.x[u-2],t.y[u-2])).getVectorToPoint(m),n=(new M(t.x+r.x,t.y+r.y)).resizeTo(r.getLength()/2),r=this.canvasContext,t=m.x,u=m.y,h=q.x,k=q.y,p=m.x+n.x,m=m.y+n.y,n=q.x,q=q.y;r.beginPath();r.moveTo(t,u);r.bezierCurveTo(p,m,n,q,h,k)}else{r=this.canvasContext,t=m.x,m=m.y,u=q.x,q=q.y,r.beginPath(),r.moveTo(t,m),r.lineTo(u,q)}r.stroke()}}};G.prototype.resetCanvas=function(B){var C=this.canvas,y=this.settings,z=this.canvasContext,x=this.isCanvasEmulator,r=C.width,u=C.height;z.clearRect(0,0,r+30,u+30);z.shadowColor=z.fillStyle=y["background-color"];x&&z.fillRect(0,0,r+30,u+30);z.lineWidth=Math.ceil(parseInt(y.lineWidth,10));z.lineCap=z.lineJoin="round";z.strokeStyle=y["decor-color"];z.shadowOffsetX=0;z.shadowOffsetY=0;var v=Math.round(u/5),e=1.5*v,t=u-v,r=r-1.5*v,u=u-v;z.beginPath();z.moveTo(e,t);z.lineTo(r,u);z.stroke();z.strokeStyle=y.color;x||(z.shadowColor=z.strokeStyle,z.shadowOffsetX=0.5*z.lineWidth,z.shadowOffsetY=-0.6*z.lineWidth,z.shadowBlur=0);B||(B=[]);z=this.dataEngine=new E(B,this,b,D,j);y.data=B;a(C).data(S+".data",B).data(S+".settings",y);var q=this.$parent,W=this.events,m=S;z.changed=function(){W.publish(m+".change");q.trigger("change")};z.changed();return !0};G.prototype.initializeCanvas=function(e){var h=document.createElement("canvas"),l=a(h);e.width===e.height&&"ratio"===e.height&&(e.width="100%");l.css("margin",0).css("padding",0).css("border","none").css("height","ratio"===e.height||!e.height?1:e.height.toString(10)).css("width","ratio"===e.width||!e.width?1:e.width.toString(10));
l.appendTo(this.$parent);"ratio"===e.height?l.css("height",Math.round(l.width()/e.sizeRatio)):"ratio"===e.width&&l.css("width",Math.round(l.height()*e.sizeRatio));l.addClass(S);h.width=l.width();h.height=l.height();e=h;if(e.getContext){e=!1}else{var l=e.ownerDocument.parentWindow,k=l.FlashCanvas?e.ownerDocument.parentWindow.FlashCanvas:"undefined"===typeof FlashCanvas?void 0:FlashCanvas;if(k){e=k.initElement(e);k=1;l&&(l.screen&&l.screen.deviceXDPI&&l.screen.logicalXDPI)&&(k=1*l.screen.deviceXDPI/l.screen.logicalXDPI);if(1!==k){try{a(e).children("object").get(0).resize(Math.ceil(e.width*k),Math.ceil(e.height*k)),e.getContext("2d").scale(k,k)}catch(i){}}e=!0}else{throw Error("Canvas element does not support 2d context. jSignature cannot proceed.")}}this.isCanvasEmulator=e;h.onselectstart=function(c){c&&c.preventDefault&&c.preventDefault();c&&c.stopPropagation&&c.stopPropagation();return !1};return h};var K=window,Q=function(e,f){var i=new Image,h=this;i.onload=function(){h.getContext("2d").drawImage(i,0,0,i.width<h.width?i.width:h.width,i.height<h.height?i.height:h.height)};i.src="data:"+f+","+e},V=function(c){this.find("canvas."+S).add(this.filter("canvas."+S)).data(S+".this").resetCanvas(c);return this},R=function(d,e){if(void 0===e&&("string"===typeof d&&"data:"===d.substr(0,5))&&(e=d.slice(5).split(",")[0],d=d.slice(6+e.length),e===d)){return}var f=this.find("canvas."+S).add(this.filter("canvas."+S));if(L.hasOwnProperty(e)){0!==f.length&&L[e].call(f[0],d,e,function(c){return function(){return c.resetCanvas.apply(c,arguments)}}(f.data(S+".this")))}else{throw Error(S+" is unable to find import plugin with for format '"+String(e)+"'")}return this},T=new s,U=S,N,P=function(){T.publish(U+".parentresized")};a(K).bind("resize."+U,function(){N&&clearTimeout(N);N=setTimeout(P,500)}).bind("mouseup."+U,function(){T.publish(U+".windowmouseup")});var o={},J={"default":function(){return this.toDataURL()},"native":function(c){return c},image:function(){var c=this.toDataURL();if("string"===typeof c&&4<c.length&&"data:"===c.slice(0,5)&&-1!==c.indexOf(",")){var d=c.indexOf(",");return[c.slice(5,d),c.substr(d+1)]}return[]}},L={"native":function(d,e,f){f(d)},image:Q,"image/png;base64":Q,"image/jpeg;base64":Q,"image/jpg;base64":Q},H={"export":J,"import":L,instance:o},F={init:function(c){return this.each(function(){var d,e=!1;for(d=this.parentNode;d&&!e;){e=d.body,d=d.parentNode}!e||new G(this,c,o)})},getSettings:function(){return this.find("canvas."+S).add(this.filter("canvas."+S)).data(S+".this").settings},isModified:function(){return this.find("canvas."+S).add(this.filter("canvas."+S)).data(S+".this").dataEngine._stroke!==null},updateSetting:function(f,e,c){var d=this.find("canvas."+S).add(this.filter("canvas."+S)).data(S+".this");d.settings[f]=e;d.resetCanvas((c?null:d.settings.data),true);return d.settings[f]},clear:V,reset:V,addPlugin:function(d,e,f){H.hasOwnProperty(d)&&(H[d][e]=f);return this},listPlugins:function(d){var e=[];if(H.hasOwnProperty(d)){var d=H[d],f;for(f in d){d.hasOwnProperty(f)&&e.push(f)}}return e},getData:function(c){var d=this.find("canvas."+S).add(this.filter("canvas."+S));void 0===c&&(c="default");if(0!==d.length&&J.hasOwnProperty(c)){return J[c].call(d.get(0),d.data(S+".data"))}},importData:R,setData:R,globalEvents:function(){return T},events:function(){return this.find("canvas."+S).add(this.filter("canvas."+S)).data(S+".this").events}};a.fn[S]=function(c){if(!c||"object"===typeof c){return F.init.apply(this,arguments)}if("string"===typeof c&&F[c]){return F[c].apply(this,Array.prototype.slice.call(arguments,1))}a.error("Method "+String(c)+" does not exist on jQuery."+S)}})();(function(){a.fn.jSignature("addPlugin","instance","UndoButton",function(b){this.events.subscribe("jSignature.attachingEventHandlers",function(){if(this.settings[b]){var c=this.settings[b];"function"!==typeof c&&(c=function(){var j=a('<span class="baseBtn">上一步</span>').appendTo(this.$signatureTools),i=j.width();j.css("left",Math.round((this.canvas.width-i)/2));i!==j.width()&&j.width(i);return j});var d=c.call(this),f=this;f.events.subscribe("jSignature.change",function(){f.dataEngine.data.length?d.show(0,function(){a(".signatureNoSave, .signatureSave").removeClass("unvisible")}):d.hide(0,function(){a(".signatureNoSave, .signatureSave").addClass("unvisible")})});var g=this,h=(this.events.topics.hasOwnProperty("jSignature.undo")?b:"jSignature")+".undo";d.bind("click",function(){g.events.publish(h)});g.events.subscribe(h,function(){var i=g.dataEngine.data;i.length&&(i.pop(),g.resetCanvas(i))})}})})})();(function(){for(var c={},d={},f="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),o=f.length/2,b=o-1;-1<b;b--){c[f[b]]=f[b+o],d[f[b+o]]=f[b]}var g=function(p){for(var p=p.split(""),m=p.length,k=1;k<m;k++){p[k]=c[p[k]]}return p.join("")},i=function(p){for(var r=[],m=0,s=1,t=p.length,u,e,q=0;q<t;q++){u=Math.round(p[q]),e=u-m,m=u,0>e&&0<s?(s=-1,r.push("Z")):0<e&&0>s&&(s=1,r.push("Y")),u=Math.abs(e),u>=o?r.push(g(u.toString(o))):r.push(u.toString(o))
}return r.join("")},l=function(s){for(var q=[],s=s.split(""),m=s.length,r,t=1,u=[],k=0,p=0;p<m;p++){r=s[p],r in c||"Z"===r||"Y"===r?(0!==u.length&&(u=parseInt(u.join(""),o)*t+k,q.push(u),k=u),"Z"===r?(t=-1,u=[]):"Y"===r?(t=1,u=[]):u=[r]):u.push(d[r])}q.push(parseInt(u.join(""),o)*t+k);return q},h=function(q){for(var m=[],k=q.length,p,r=0;r<k;r++){p=q[r],m.push(i(p.x)),m.push(i(p.y))}return m.join("_")},n=function(q){for(var m=[],q=q.split("_"),k=q.length/2,p=0;p<k;p++){m.push({x:l(q[2*p]),y:l(q[2*p+1])})}return m},f=function(k){return["image/jsignature;base30",h(k)]},b=function(p,m,k){"string"===typeof p&&("image/jsignature;base30"===p.substring(0,23).toLowerCase()&&(p=p.substring(24)),k(n(p)))};if(null==this.jQuery){throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...")}var j=this.jQuery.fn.jSignature;j("addPlugin","export","base30",f);j("addPlugin","export","image/jsignature;base30",f);j("addPlugin","import","base30",b);j("addPlugin","import","image/jsignature;base30",b);this.jSignatureDebug&&(this.jSignatureDebug.base30={remapTailChars:g,compressstrokeleg:i,uncompressstrokeleg:l,compressstrokes:h,uncompressstrokes:n,charmap:c})}).call("undefined"!==typeof window?window:this);(function(){function c(e,h){this.x=e;this.y=h;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var k=function(m){return Math.round(m/Math.abs(m))};this.resizeTo=function(m){if(0===this.x&&0===this.y){this._length=0}else{if(0===this.x){this._length=m,this.y=m*k(this.y)}else{if(0===this.y){this._length=m,this.x=m*k(this.x)}else{var p=Math.abs(this.y/this.x),q=Math.sqrt(Math.pow(m,2)/(1+Math.pow(p,2))),p=p*q;this._length=m;this.x=q*k(this.x);this.y=p*k(this.y)}}}return this};this.angleTo=function(m){var p=this.getLength()*m.getLength();return 0===p?0:Math.acos(Math.min(Math.max((this.x*m.x+this.y*m.y)/p,-1),1))/Math.PI}}function f(e,h){this.x=e;this.y=h;this.getVectorToCoordinates=function(k,m){return new c(k-this.x,m-this.y)};this.getVectorFromCoordinates=function(k,m){return this.getVectorToCoordinates(k,m).reverse()};this.getVectorToPoint=function(k){return new c(k.x-this.x,k.y-this.y)};this.getVectorFromPoint=function(k){return this.getVectorToPoint(k).reverse()}}function g(e,h){var k=Math.pow(10,h);return Math.round(e*k)/k}function A(h,m,q){var m=m+1,r=new f(h.x[m-1],h.y[m-1]),p=new f(h.x[m],h.y[m]),p=r.getVectorToPoint(p),k=new f(h.x[m-2],h.y[m-2]),r=k.getVectorToPoint(r);return r.getLength()>q?(q=2<m?(new f(h.x[m-3],h.y[m-3])).getVectorToPoint(k):new c(0,0),h=0.35*r.getLength(),k=r.angleTo(q.reverse()),m=p.angleTo(r.reverse()),q=(new c(q.x+r.x,q.y+r.y)).resizeTo(Math.max(0.05,k)*h),p=(new c(r.x+p.x,r.y+p.y)).reverse().resizeTo(Math.max(0.05,m)*h),p=new c(r.x+p.x,r.y+p.y),["c",g(q.x,2),g(q.y,2),g(p.x,2),g(p.y,2),g(r.x,2),g(r.y,2)]):["l",g(r.x,2),g(r.y,2)]}function b(h,m){var q=h.x.length-1,r=new f(h.x[q],h.y[q]),p=new f(h.x[q-1],h.y[q-1]),r=p.getVectorToPoint(r);if(1<q&&r.getLength()>m){var q=(new f(h.x[q-2],h.y[q-2])).getVectorToPoint(p),p=r.angleTo(q.reverse()),k=0.35*r.getLength(),q=(new c(q.x+r.x,q.y+r.y)).resizeTo(Math.max(0.05,p)*k);return["c",g(q.x,2),g(q.y,2),g(r.x,2),g(r.y,2),g(r.x,2),g(r.y,2)]}return["l",g(r.x,2),g(r.y,2)]}function j(h,k,m){for(var k=["M",g(h.x[0]-k,2),g(h.y[0]-m,2)],m=1,p=h.x.length-1;m<p;m++){k.push.apply(k,A(h,m,1))}0<p?k.push.apply(k,b(h,m,1)):0===p&&k.push.apply(k,["l",1,1]);return k.join(" ")}function n(D){var y=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],z,B=D.length,t,v=[],x=[],u=t=z=0,q=0,e=[];if(0!==B){for(z=0;z<B;z++){u=D[z];q=[];t={x:[],y:[]};for(var r=void 0,C=void 0,r=0,C=u.x.length;r<C;r++){q.push({x:u.x[r],y:u.y[r]})}q=simplify(q,0.7,!0);r=0;for(C=q.length;r<C;r++){t.x.push(q[r].x),t.y.push(q[r].y)}e.push(t);v=v.concat(t.x);x=x.concat(t.y)}D=Math.min.apply(null,v)-1;B=Math.max.apply(null,v)+1;v=Math.min.apply(null,x)-1;x=Math.max.apply(null,x)+1;u=0>D?0:D;q=0>v?0:v;z=B-D;t=x-v}y.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+z.toString()+'" height="'+t.toString()+'">');z=0;for(B=e.length;z<B;z++){t=e[z],y.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="'+j(t,u,q)+'"/>')}y.push("</svg>");return y.join("")}function s(e){return[d,n(e)]}function l(e){return[i,o(n(e))]}var w=window;"use strict";("undefined"!=typeof exports?exports:w).simplify=function(R,N,O){N=void 0!==N?N*N:1;if(!O){for(var P=R.length,H,K=R[0],L=[K],O=1;O<P;O++){H=R[O];var I=H.x-K.x,F=H.y-K.y;I*I+F*F>N&&(L.push(H),K=H)}R=(K!==H&&L.push(H),L)}H=R;var O=H.length,P=new ("undefined"!=typeof Uint8Array?Uint8Array:Array)(O),K=0,L=O-1,G,E,Q=[],J=[],B=[];for(P[K]=P[L]=1;L;){F=0;for(I=K+1;I<L;I++){G=H[I];var M=H[K],C=H[L],D=M.x,z=M.y,M=C.x-D,y=C.y-z,x=void 0;
if(0!==M||0!==y){x=((G.x-D)*M+(G.y-z)*y)/(M*M+y*y),1<x?(D=C.x,z=C.y):0<x&&(D+=M*x,z+=y*x)}G=(M=G.x-D,y=G.y-z,M*M+y*y);G>F&&(E=I,F=G)}F>N&&(P[E]=1,Q.push(K),J.push(E),Q.push(E),J.push(L));K=Q.pop();L=J.pop()}for(I=0;I<O;I++){P[I]&&B.push(H[I])}return R=B,R};if("function"!==typeof o){var o=function(z){var v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),x,y,u,t,r=0,q=0,p="",p=[];do{x=z.charCodeAt(r++),y=z.charCodeAt(r++),u=z.charCodeAt(r++),t=x<<16|y<<8|u,x=t>>18&63,y=t>>12&63,u=t>>6&63,t&=63,p[q++]=v[x]+v[y]+v[u]+v[t]}while(r<z.length);p=p.join("");z=z.length%3;return(z?p.slice(0,z-3):p)+"===".slice(z||3)}}var d="image/svg+xml",i="image/svg+xml;base64";if("undefined"===typeof a){throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...")}w=a.fn.jSignature;w("addPlugin","export","svg",s);w("addPlugin","export",d,s);w("addPlugin","export","svgbase64",l);w("addPlugin","export",i,l)})()})(jQuery);